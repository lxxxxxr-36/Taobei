- type: Backend
  id: API-POST-RequestCode
  route: POST /api/auth/request-code
  description: 处理验证码获取请求，校验手机号格式并生成6位验证码。
  input:
    type: JSON
    body:
      phoneNumber: string
  output:
    success:
      statusCode: 200
      body: { message: "验证码已发送", ttlSeconds: 60 }
    error:
      - statusCode: 400
        body: { error: "请输入正确的手机号码" }
  dependencies:
    - DB-CreateVerificationCode
  acceptanceCriteria:
    - 当手机号格式正确时，生成6位验证码并保存，有效期60秒。
    - 控制台打印验证码（用于测试），接口返回200与ttlSeconds:60。
    - 手机号格式无效时返回400并提示“请输入正确的手机号码”。
  changeLog:
    - date: "2025-10-13"
      description: "初始创建。"

- type: Backend
  id: API-POST-Login
  route: POST /api/auth/login
  description: 处理用户登录请求，校验手机号注册状态与验证码有效性。
  input:
    type: JSON
    body:
      phoneNumber: string
      verificationCode: string
  output:
    success:
      statusCode: 200
      body: { message: "登录成功", redirectTo: "/" }
    error:
      - statusCode: 404
        body: { error: "该手机号未注册，请先完成注册" }
      - statusCode: 400
        body: { error: "验证码错误" }
      - statusCode: 410
        body: { error: "验证码已过期" }
  dependencies:
    - DB-FindUserByPhone
    - DB-VerifyCode
  acceptanceCriteria:
    - 使用未注册手机号登录时返回404并提示“该手机号未注册，请先完成注册”。
    - 使用已注册手机号但验证码错误时返回400并提示“验证码错误”。
    - 使用已注册手机号且验证码过期时返回410并提示“验证码已过期”。
    - 使用已注册手机号且验证码正确时返回200，提示“登录成功”，并返回 redirectTo="/"。
  changeLog:
    - date: "2025-10-13"
      description: "初始创建。"

- type: Backend
  id: API-POST-RegisterRequestCode
  route: POST /api/auth/register/request-code
  description: 注册页面验证码获取请求，逻辑同登录请求，但场景为注册。
  input:
    type: JSON
    body:
      phoneNumber: string
  output:
    success:
      statusCode: 200
      body: { message: "验证码已发送", ttlSeconds: 60 }
    error:
      - statusCode: 400
        body: { error: "请输入正确的手机号码" }
  dependencies:
    - DB-CreateVerificationCode
  acceptanceCriteria:
    - 当手机号格式正确时，生成6位验证码并保存，有效期60秒。
    - 控制台打印验证码（用于测试），接口返回200与ttlSeconds:60。
    - 手机号格式无效时返回400并提示“请输入正确的手机号码”。
  changeLog:
    - date: "2025-10-13"
      description: "新增注册验证码接口。"

- type: Backend
  id: API-POST-Register
  route: POST /api/auth/register
  description: 处理用户注册请求：校验验证码、检查是否同意协议、创建用户或直接登录。
  input:
    type: JSON
    body:
      phoneNumber: string
      verificationCode: string
      agreeProtocol: boolean
  output:
    success:
      statusCode: 200
      body: { message: "注册成功", redirectTo: "/" }
    error:
      - statusCode: 409
        body: { error: "该手机号已注册，将直接为您登录" }
      - statusCode: 400
        body: { error: "验证码错误" }
      - statusCode: 410
        body: { error: "验证码已过期" }
      - statusCode: 412
        body: { error: "请先同意《淘贝用户协议》" }
  dependencies:
    - DB-FindUserByPhone
    - DB-VerifyCode
    - DB-CreateUser
  acceptanceCriteria:
    - 未注册手机号 + 正确验证码 + 勾选协议 -> 创建用户并返回200，提示“注册成功”，redirectTo="/"。
    - 已注册手机号 + 正确验证码 -> 返回409并提示“该手机号已注册，将直接为您登录”。
    - 验证码错误 -> 返回400并提示“验证码错误”。
    - 验证码过期 -> 返回410并提示“验证码已过期”。
    - 未勾选协议 -> 返回412并提示“请先同意《淘贝用户协议》”。
  changeLog:
    - date: "2025-10-13"
      description: "新增注册接口。"